@(user: Option[User], title: String = "", selectedTag: Option[Tag] = None)(content: Html)(initScript: Html = Html(""))
<!DOCTYPE html>
<html class="no-js">
	<head>
		<meta charset="utf-8">
		<title>repost@(if (!title.isEmpty) " - " + title)</title>
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" href="@routes.Assets.at("stylesheets/bootstrap.min.css")">
		<link rel="stylesheet" href="@routes.Assets.at("stylesheets/bootstrap-theme.min.css")">
		<link rel="stylesheet" href="@routes.Assets.at("stylesheets/perfect-scrollbar.css")">
		<link rel="stylesheet" href="@routes.Assets.at("stylesheets/jquery.sceditor.default.theme.min.css")">
		<link rel="stylesheet" href="@routes.Assets.at("stylesheets/highlight/dark.css")">
		<link rel="stylesheet" href="@routes.Assets.at("stylesheets/main.css")">

		<script src="@routes.Assets.at("javascripts/jquery-1.11.0.min.js")"></script>
	</head>
	<body>
		<!--[if IE]>
			<p class="browsehappy">You are using <strong>internet explorer</strong>.
			Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
		<![endif]-->
		<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
			<a class="navbar-brand" href="/">repost</a>
			<form method="get" action="/search" class="navbar-form navbar-right">
				<div class="input-group">
					<div class="form-group input-group-sm">
						<input type="text" name="query" class="form-control">
						<span class="input-group-btn">
							<button type="submit" class="btn btn-default" tabindex="-1">search</button>
						</span>
					</div>
				</div>
			</form>
			@if(user.isDefined) {
				<div class="btn-group btn-group-sm navbar-form navbar-right">
					<div class="btn-group btn-group-sm">
						<button type="button" class="btn btn-info btn-sm dropdown-toggle" data-toggle="dropdown" tabindex="-1">
							@user.get.name
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu">
							<li><a href="/user/@(if (user.isDefined) user.get.id)"><button class="btn btn-link btn-sm">settings</button></a></li>
							<li><a><form method="post" action="/logout">
								<button type="submit" class="btn btn-link btn-sm">sign out</button>
							</form></a></li>
						</ul>
						<a href="/entry/save"><button type="button" class="btn btn-sm btn-success">add entry</button></a>
					</div>
				</div>
			} else {
				<form method="post" action="/auth" class="navbar-form navbar-right" role="form">
					<div class="form-group input-group-sm">
						<input type="text" placeholder="login" class="form-control" name="name">
					</div>
					<div class="form-group input-group-sm">
						<input type="password" placeholder="password" class="form-control" name="pass">
					</div>
					<button type="submit" class="btn btn-default btn-sm" tabindex="-1">sign in</button>
					<a class="btn-link btn-sm" href="/register">register</a>
				</form>
			}
		</div>

		<div class="container-fluid">
			<div class="row">
				<div class="col-xs-10">
					@if(selectedTag.isDefined) {
						<h3>@selectedTag.get.title:</h3>
					}
					@content
				</div>
				@if(user.isDefined) {
					<div class="col-xs-2">
						<div class="panel panel-default h5">
							<div class="panel-heading">favorite tags:</div>
								<div class="list-group favorite-list">
									<div id="favoriteTagList">
										@for(tag <- user.get.favoriteTags) {
											<a href="/tag/@tag.title" id="favorite@tag.title"
													class="list-group-item@(if (selectedTag.isDefined && selectedTag.get.id == tag.id) " active")">
												@tag.title
												<button type="button" class="btn btn-default btn-xs pull-right" id="removeFavorite@tag.title">remove</button>
											</a>
										}
									</div>
									<input type="text" placeholder="add" class="form-control list-group-item" id="favoriteTags">
								</div>
						</div>
					</div>
				}
			</div>
		</div>

		<script src="@routes.Assets.at("javascripts/bootstrap.min.js")"></script>
		<script src="@routes.Assets.at("javascripts/perfect-scrollbar-0.4.9.with-mousewheel.min.js")"></script>
		<script src="@routes.Assets.at("javascripts/jquery.color-2.1.2.min.js")"></script>
		<script src="@routes.Assets.at("javascripts/jquery.autocomplete.min.js")"></script>
		<script src="@routes.Assets.at("javascripts/jquery.sceditor.bbcode.min.js")"></script>
		<script src="@routes.Assets.at("javascripts/highlight.pack.js")"></script>
		<script>
			$('#pageScroll').perfectScrollbar();
			hljs.initHighlightingOnLoad();

			var favoriteTagList = $('#favoriteTagList');
			var tagInput = $('#favoriteTags');
			var addFavoriteTags = function(str) {
				str.
					split(',').
					filter(function(s) {return /^[\w \-]+$/.test(s);}).
					forEach(function(s) {
						var tagName = s.trim();
						$.post('/favorite/add/' + tagName, null, function(response) {
							if ('true' === response) {
								$('<a href="/tag/' + tagName + '" id="favorite' + tagName + '" class="list-group-item">' + tagName +
									'<button type="button" class="btn btn-default btn-xs pull-right" id="removeFavorite' + tagName + '">remove</button></a>').
									appendTo(favoriteTagList);
								$('#removeFavorite' + tagName).click(function(event) {
									event.preventDefault();
									$.post('/favorite/remove/' + tagName, null, function(response) {
										if ('true' === response)
											$('#favorite' + tagName).remove();
									});
								});
							}
						});
					}
				);
			};
			tagInput.keypress(function(event) {
				if (event.keyCode == 13 && tagInput.val()) {
					event.preventDefault();
					addFavoriteTags(tagInput.val());
					tagInput.val("");
				}
			});
			tagInput.autocomplete({
				serviceUrl: '/tags',
				deferRequestBy: 250,
				delimiter: ',',
				triggerSelectOnValidInput: false,
				onSelect: function(suggestion) {
					addFavoriteTags(suggestion.value);
					tagInput.val("");
				}
			});

			@if(user.isDefined) {
				@for(tag <- user.get.favoriteTags) {
					$('#removeFavorite@tag.title').click(function(event) {
						event.preventDefault();
						$.post('/favorite/remove/@tag.title', null, function(response) {
							if ('true' === response)
								$('#favorite@tag.title').remove();
						});
					});
				}
			}
		</script>
		@initScript
	</body>
</html>