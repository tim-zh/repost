@(user: Option[User], errors: Seq[FormError] = Nil, badData: Map[String, String] = Map.empty)
@wrapper(user) {
	<br/>
	<form method="post" action="/entry/save" class="form-horizontal" role="form">
		@renderInput(errors, badData, "title", "title", "text", "title")()
		@renderInput(errors, badData, "tags", "tags", "text") {
			<span id="tagListContainer"></span>
		}
		<input type="hidden" name="tagsHiddenString" id="tagsHiddenString">
		<div class="form-group">
			<label class="col-xs-offset-2 col-xs-4" for="openForAll">
				<input type="checkbox" name="openForAll" id="openForAll">
				open for all
			</label>
		</div>
		<div class="form-group@(if (errors.exists(_.key == "content")) " has-error")">
			<label for="content" class="col-xs-2 control-label">content</label>
			<div class="col-xs-9">
				<textarea class="form-control" name="content" id="content" rows="15"></textarea>
				@defining(errors.filter(_.key == "content").iterator) { i =>
					@for(error <- i) {
						<span class="help-block">@error.message@(if(i.hasNext) ", " else "")</span>
					}
				}
			</div>
		</div>
		<div class="form-group">
			<div class="col-xs-offset-2 col-xs-4">
				<button type="submit" class="btn btn-success btn-sm">add entry</button>
			</div>
		</div>
	</form>
} {
	<script>
		var tagList = $('#tagListContainer');
		var tagInput = $('#tags');
		var addTags = function(str) {
			str.
				split(',').
				filter(function(s) {return /^[\w \-]+$/.test(s);}).
				forEach(function(s) {
					var tagName = s.trim();
					var tagString = $('#tagsHiddenString');
					tagString.val(tagString.val() + ',' + tagName);
					$('<a href="#" id="tag' + tagName + '" class="label label-info" style="margin-left:4px;">' + tagName + ' Ã—</a>').
						appendTo(tagList).click(function() {
							var tagNames = tagString.val().split(',');
							tagNames = tagNames.filter(function(e) {return e !== tagName;});
							tagString.val(tagNames.join());
							$('#tag' + tagName).remove();
						});
				}
			);
		};
		tagInput.keypress(function(event) {
			if (event.keyCode == 13 && tagInput.val()) {
				event.preventDefault();
				addTags(tagInput.val());
				tagInput.val("");
			}
		});
		@if(badData.contains("tagsHiddenString") && !badData("tagsHiddenString").isEmpty) {
			addTags('@(badData("tagsHiddenString"))');
		}
	</script>
}